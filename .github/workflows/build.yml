name: Build Geode Mod (Manual)

on:
  push:
    branches: [main, master]
  workflow_dispatch:

jobs:
  build:
    strategy:
      matrix:
        target: [Win, Mac, Android64] # Use capitalized names for artifacts
    
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
      
      - name: Configure Git
        run: git config --global url."https://".insteadOf git://

      - name: Download Geode Build Tools
        run: git clone --recursive https://github.com/geode-sdk/build-tools.git      

      - name: Compile Mod
        # The build script expects lowercase targets (win, mac, android64)
        run: |
          TARGET_LOWERCASE=$(echo "${{ matrix.target }}" | tr '[:upper:]' '[:lower:]')
          ./build-tools/build.sh $TARGET_LOWERCASE
          

      - name: Find Output Path
        id: find_path
        run: |
          # The build script places the output in the build folder
          MOD_PATH=$(find ./build -name '*.geode')
          echo "mod-path=$MOD_PATH" >> $GITHUB_OUTPUT

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: SeraphicMod-${{ matrix.target }}
          path: build/SeraphicMod.geode # Adjust path if needed, but this is standard
          
